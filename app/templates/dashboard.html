<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Modern Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      :root {
    --bg-dark: rgba(20, 20, 30, 0.7);
    --bg-light: rgba(240, 240, 250, 0.7);
    --text-dark: #ffffff;
    --text-light: #333333;
    --accent: #646cff;
    --accent-hover: #535bf2;
    --transition: all 0.3s ease;
}

body {
    margin: 0;
    min-height: 100vh;
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: var(--text-dark);
    transition: var(--transition);
}

body[data-theme="light"] {
    background: linear-gradient(135deg, #e0e0f0 0%, #d0d0e0 100%);
    color: var(--text-light);
}

.container {
    padding: 2rem;
    max-width: 100%;
}

.glass-panel {
    background: rgba(30, 30, 50, 0.4);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
    padding: 1.5rem;
    margin-bottom: 2rem;
    transition: var(--transition);
}

body[data-theme="light"] .glass-panel {
    background: rgba(255, 255, 255, 0.4);
    border: 1px solid rgba(0, 0, 0, 0.1);
}

h2 {
    margin-top: 0;
    font-weight: 500;
}

/* Scroll containers */
.scroll-x-only {
    overflow-x:auto;
    width: 100%;
    border-radius: 12px;
    margin-top: 1rem;
}

.normal-view {
    width: 100%;
    overflow: hidden;
}

/* Graph controls */
.graph-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.graph-buttons {
    display: flex;
    gap: 2rem;
}

button, .graph-buttons a {
    padding: 0.5rem 1rem;
    background: rgba(100, 108, 255, 0.2);
    border: 1px solid var(--accent);
    border-radius: 8px;
    color: var(--accent);
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    font-size: 0.9rem;
}

button:hover, .graph-buttons a:hover {
    background: rgba(100, 108, 255, 0.3);
    border-color: var(--accent-hover);
    color: var(--accent-hover);
}

/* Navbar styles */
.top-navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    background: rgba(20, 20, 40, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

body[data-theme="light"] .top-navbar {
    background: rgba(255, 255, 255, 0.8);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-logo {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.nav-logo img {
    height: 40px;
    width: auto;
}

.nav-logo h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-dark);
}

body[data-theme="light"] .nav-logo h1 {
    color: var(--text-light);
}

.nav-menu {
    display: flex;
    gap: 2rem;
}

.nav-menu a {
    color: var(--text-dark);
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: var(--transition);
}

body[data-theme="light"] .nav-menu a {
    color: var(--text-light);
}

.nav-menu a:hover {
    background: rgba(100, 108, 255, 0.2);
    color: var(--accent);
}

/* Theme toggle button styles */
#themeToggle {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-dark);
    font: inherit;
    margin: 0;
}

body[data-theme="light"] #themeToggle {
    color: var(--text-light);
}

#themeToggle:hover {
    background: rgba(100, 108, 255, 0.1);
    border-radius: 8px;
}

.theme-icon {
    font-size: 1.2rem;
}

.theme-label {
    font-size: 0.9rem;
}

/* Date range selector */
.date-range-selector {
    display: flex;
    align-items: center;
}

.date-input-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-input {
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--text-dark);
    min-width: 120px;
}

body[data-theme="light"] .date-input {
    background: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: var(--text-light);
}

.date-submit {
    padding: 0.5rem 1rem;
    background: rgba(100, 108, 255, 0.2);
    border: 1px solid var(--accent);
    border-radius: 8px;
    color: var(--accent);
    cursor: pointer;
    transition: var(--transition);
}

.date-submit:hover {
    background: rgba(100, 108, 255, 0.3);
}

/* Response Message Styling */
#responseMessage {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background-color: rgba(100, 108, 255, 0.9);
    color: white;
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    font-size: 0.9rem;
    z-index: 9999;
    display: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
    </style>
</head>
<body>
    <!-- âœ… Response Message Element -->
    <div id="responseMessage"></div>

    <!-- Existing Layout Below -->
    <nav class="top-navbar">
        <div class="nav-logo">
            <img src="/static/IITT_InIf_svg2-01.png" alt="Logo">
            <h1>Navavishkar Hub</h1>
        </div>
        <div class="nav-menu">
            <a href="/" class="nav-link">Home</a>
            <a href="/dashboard" class="nav-link">Dashboard</a>
            <a href="/about" class="nav-link">About</a>
            <button id="themeToggle" class="theme-toggle-btn" aria-label="Toggle theme">
                <span class="theme-icon">ðŸŒ“</span>
                <span class="theme-label">Theme</span>
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Top Graph -->
        <div class="glass-panel" style="min-height: 500px;">
            <div class="graph-header">
                <h2>Daily Data</h2>
                <div class="date-selector">
                    <form method="POST" id="dateForm">
                        <div class="date-input-group">
                            <input type="text" class="date-input" id="startDate" name="start_date" value="{{ start_date }}" placeholder="Start Date">
                            <span>to</span>
                            <input type="text" class="date-input" id="endDate" name="end_date" value="{{ end_date }}" placeholder="End Date">
                            <button type="submit" class="date-submit">Apply</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="scroll-x-only" style="height: 800px;">
                <div id="top-graph"></div>
            </div>
        </div>

        <!-- Middle Graph -->
        <div class="glass-panel">
            <div class="graph-header">
                <h2>Day Graph</h2>
                <div class="date-range-selector">
                    <form method="POST" id="dateForm">
                        <input type="text" class="date-input" id="selectedDate" name="selected_date" value="{{ selected_date }}" placeholder="Select Date">
                        <button type="submit" class="date-submit">Load</button>
                    </form>
                </div>
            </div>
            <div class="normal-view" style="height: 800px;">
                <div id="mid-graph"></div>
            </div>
        </div>

        <!-- Bottom Graph -->
        <div class="glass-panel">
            <div class="graph-header">
                <h2>Predicted Graph</h2>
                <div class="graph-buttons">
                    <a href="/set_mode/lines" onclick="updateBotGraph(event)">Line</a>
                    <a href="/set_mode/markers" onclick="updateBotGraph(event)">Scatter</a>
                    <a href="/set_mode/lines+markers" onclick="updateBotGraph(event)">Both</a>
                    <a href="/set_type/bar" onclick="updateBotGraph(event)">Bar</a>
                </div>
            </div>
            <div class="normal-view" style="height: 500px;">
                <div id="bot-graph"></div>
            </div>
        </div>
    </div>

    <script>
        // âœ… Response Message Handler
        function showResponseMessage(msg) {
            const box = document.getElementById('responseMessage');
            box.textContent = msg;
            box.style.display = 'block';
            setTimeout(() => {
                box.style.display = 'none';
            }, 3000);
        }

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', function () {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            updateAllGraphs(newTheme === 'dark');
            localStorage.setItem('themePreference', newTheme);
        });

        function initializeTheme() {
            const savedTheme = localStorage.getItem('themePreference') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            updateAllGraphs(savedTheme === 'dark');
        }

        let topData = JSON.parse('{{ top|safe }}');
        let midData = JSON.parse('{{ mid|safe }}');
        let botData = JSON.parse('{{ bot|safe }}');

        function updateAllGraphs(darkMode) {
            const bgColor = darkMode ? 'rgba(20, 20, 30, 0.7)' : 'rgba(240, 240, 250, 0.7)';
            const textColor = darkMode ? '#ffffff' : '#333333';
            const gridColor = darkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

            [topData, midData, botData].forEach(data => {
                data.layout.plot_bgcolor = bgColor;
                data.layout.paper_bgcolor = 'rgba(0,0,0,0)';
                data.layout.font.color = textColor;
                data.layout.xaxis.gridcolor = gridColor;
                data.layout.yaxis.gridcolor = gridColor;
            });

            Plotly.react('top-graph', topData.data, topData.layout);
            Plotly.react('mid-graph', midData.data, midData.layout);
            Plotly.react('bot-graph', botData.data, botData.layout);
        }

        function updateBotGraph(event) {
            event.preventDefault();
            fetch(event.target.href)
                .then(response => response.json())
                .then(data => {
                    botData = data;
                    Plotly.react('bot-graph', data.data, data.layout);
                    showResponseMessage("Bottom graph view updated!");
                });
        }

        window.addEventListener('DOMContentLoaded', initializeTheme);

        Plotly.newPlot('top-graph', topData.data, topData.layout);
        Plotly.newPlot('mid-graph', midData.data, midData.layout);
        Plotly.newPlot('bot-graph', botData.data, botData.layout);

        flatpickr("#startDate", {
            dateFormat: "Y-m-d",
            defaultDate: "{{ start_date }}",
            maxDate: "{{ end_date }}"
        });

        flatpickr("#endDate", {
            dateFormat: "Y-m-d",
            defaultDate: "{{ end_date }}",
            minDate: "{{ start_date }}"
        });

        flatpickr("#selectedDate", {
            dateFormat: "Y-m-d",
            defaultDate: "{{ selected_date }}",
            maxDate: "today"
        });

        // Top Graph Update
        document.getElementById('dateForm').addEventListener('submit', function (e) {
            e.preventDefault();
            fetch('/', {
                method: 'POST',
                body: new FormData(this),
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const newTopData = JSON.parse(doc.getElementById('top-graph').getAttribute('data-plot'));
                Plotly.react('top-graph', newTopData.data, newTopData.layout);
                showResponseMessage("Top graph updated successfully!");
            });
        });

        // Mid Graph Update
        document.getElementById('dateForm').addEventListener('submit', function (e) {
            e.preventDefault();
            fetch('/', {
                method: 'POST',
                body: new FormData(this),
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const newMidData = JSON.parse(doc.getElementById('mid-graph').getAttribute('data-plot'));
                Plotly.react('mid-graph', newMidData.data, newMidData.layout);
                showResponseMessage("Mid graph updated successfully!");
            });
        });

        window.onload = () => {
            document.querySelector('.scroll-x-only').scrollLeft = 10000;
        };
    </script>
</body>
</html>
